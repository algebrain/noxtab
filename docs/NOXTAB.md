# NoxTab

## Мотивация
NoxTab нужен для ситуаций, когда браузер уже запущен с remote-debugging и требуется быстро, повторяемо и без ручных кликов проверить поведение фронтенда.

Типовые боли, которые решает инструмент:
- нужно автоматизировать несколько однотипных действий (ввод, клик, проверка результата);
- нужно получить машинно-проверяемый факт состояния страницы, а не только визуальное впечатление;
- нужно работать из терминала/агента, а не только через DevTools UI;
- нужно фиксировать шаги отладки скриншотами и JSON-результатами `eval`.

## Что это
NoxTab - CLI-инструмент поверх Chrome DevTools Protocol (CDP), который подключается к Chrome на `127.0.0.1:9222` и управляет выбранной вкладкой.

Базовые возможности:
- список доступных вкладок (`list`);
- переход по URL (`open`);
- выполнение JavaScript в контексте страницы (`eval`);
- действия по селектору (`click`, `type`);
- снятие скриншота (`screenshot`) с авто-нумерацией файлов;
- поток консольных и runtime-событий (`logs`).

## Для кого документ
Документ ориентирован в первую очередь на ИИ-агента/автоматизацию, но пригоден и для ручной работы человека.

## Предусловия
1. Установлен Node.js.
2. Запущен Chrome с CDP-портом:
   - `chrome --remote-debugging-port=9222`
3. Поднят целевой сайт (локально или на тестовом стенде).
4. Перед началом работы созданы каталоги скриншотов (пример):
   - `<project>/screenshots`
   - `tool/screenshots`

Примечание: NoxTab умеет создавать каталог при сохранении скриншота, но для стабильных сценариев агента лучше проверять наличие каталогов заранее.

## Быстрый старт
Из папки `tool`:

```bash
npm install
node cdp-tool.js list
node cdp-tool.js eval "document.title"
```

Примерный сценарий (предположим, что разрабатываемый проект лежит в папке `demo`):

```bash
node cdp-tool.js open http://127.0.0.1:8090
node cdp-tool.js type --url-contains=127.0.0.1:8090 "#todoInput" "buy milk"
node cdp-tool.js click --url-contains=127.0.0.1:8090 "#addBtn"
node cdp-tool.js eval --url-contains=127.0.0.1:8090 "document.querySelectorAll('#todoList .todo').length"
node cdp-tool.js screenshot --url-contains=127.0.0.1:8090 ../demo/screenshots/state.png
```

## Выбор вкладки
Если открыто несколько вкладок, NoxTab выбирает цель так:
1. `--target=<id>` - приоритетный точный выбор;
2. фильтры `--url-contains` и/или `--title-contains`;
3. первый подходящий page-target.

Рекомендация для агента: всегда указывать `--url-contains`, чтобы избежать действий в неправильной вкладке.

## Команды
- `list` - вывод вкладок (id, title, url).
- `open <url>` - навигация активной целевой вкладки.
- `eval <js>` - выполнение JS; результат печатается как JSON.
- `click <selector>` - `element.click()` для первого совпавшего селектора.
- `type <selector> <text>` - фокус, запись `value`, события `input` и `change`.
- `screenshot <path>` - PNG; без перезаписи, с нумерацией `-001`, `-002`, ...
- `logs` - поток `console.*` и `exception` до `Ctrl+C`.

## Паттерн использования агентом
1. Проверить доступность CDP: `list`.
2. Зафиксировать целевую вкладку фильтром URL.
3. Выполнить действия (`type/click/open`).
4. Подтвердить состояние через `eval` (структурированные данные).
5. Снять скриншот в `<project>/screenshots` или `tool/screenshots`.
6. Повторить шаги при необходимости, не удаляя старые скриншоты.

## Проверка и диагностика
Симптомы и действия:
- Ошибка подключения к `9222`:
  - проверить запуск Chrome с `--remote-debugging-port=9222`.
- `No targets matched`:
  - уточнить `--url-contains` или вызвать `list`.
- `not-found` для селектора:
  - проверить, что DOM загружен и селектор корректен.
- Нет эффекта от действия:
  - проверить бизнес-логику страницы через `eval` и `logs`.

## Практика хранения артефактов
- Держать скриншоты в отдельных папках:
  - `<project>/screenshots` для продуктовых проверок;
  - `tool/screenshots` для технических проверок агента.
- Использовать осмысленные имена базового файла:
  - `login.png`, `theme-check.png`, `todo-add.png`.
- Не удалять старые снимки в ходе сессии: история нумерации полезна для сравнения.

## Ограничения
- Инструмент не заменяет e2e-фреймворк (Playwright/Cypress), а закрывает быстрые сценарии терминальной отладки.
- `click` работает по первому совпавшему селектору.
- Для сложной синхронизации лучше использовать `eval` с проверкой состояния и повторными попытками.

## Сводка
NoxTab - легковесный CDP-CLI для управляемой отладки вкладки Chrome из терминала/агента. Его сила - в простых, повторяемых шагах: действие -> проверка -> скриншот.
